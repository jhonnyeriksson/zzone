<config-template xmlns="http://tail-f.com/ns/config/1.0" servicepoint="GCSE">
	<devices xmlns="http://tail-f.com/ns/ncs">
		<device>
			<name>{/device}</name>
			<config>
				<?foreach {/GCSE/transport-information/options/settings/equipment-information/nodes}?>
					<?if {/GCSE/transport-information/options/settings/equipment-information/nodes/node-type = 'PE'}?>
						<?foreach {/GCSE/transport-information/options/settings/equipment-information/nodes/PE}?>
							<?if {/GCSE/transport-information/options/settings/equipment-information/nodes/PE/software = 'iosxr'}?>
								<?if {/GCSE/service-information/network-options/protocol = 'vpnv4'}?>
									<vrf xmlns="http://tail-f.com/ned/cisco-ios-xr">
										<vrf-list>
											<name>{/GCSE/service-information/network-options/vpnv4/vrf}</name>
											<rd>{/GCSE/service-information/network-options/vpnv4/route-distinguisher}</rd>
											<address-family>
												<ipv4>
													<unicast>
														<import>
															<route-target>
																<address-list>
																	<name>{/GCSE/service-information/network-options/vpnv4/route-target-import}</name>
																</address-list>
															</route-target>
														</import>
														<export>
															<route-target>
																<address-list>
																	<name>{/GCSE/service-information/network-options/vpnv4/route-target-export}</name>
																</address-list>
															</route-target>
														</export>
													</unicast>
												</ipv4>
											</address-family>
										</vrf-list>
									</vrf>
								<?end?>
								<interface xmlns="http://tail-f.com/ned/cisco-ios-xr">
									<GigabitEthernet-subinterface>
										<GigabitEthernet>
											<?foreach {/GCSE/transport-information/options/settings/equipment-information/nodes/PE/service-transport}?>
												<id>{/GCSE/transport-information/options/settings/equipment-information/nodes/PE/service-transport/service-interface}</id>
											<?end?>
											<?if {/GCSE/transport-information/options/settings/circuit-information/fttx/encapsulation/encapsulation-type = 'dot1q'}?>
												<encapsulation>
													<dot1q>
														<vlan-id>{/GCSE/transport-information/options/settings/circuit-information/fttx/encapsulation/dot1q/cvlan}</vlan-id>
													</dot1q>
												</encapsulation>
											<?end?>
											<?if {/GCSE/service-information/network-options/protocol = 'vpnv4'}?>
												<vrf>{/GCSE/service-information/network-options/vpnv4/vrf}</vrf>
											<?end?>
											<?foreach {/GCSE/service-information/service-options/ip-settings/ip/network/hosts}?>
												<?if {/device = /GCSE/service-information/service-options/ip-settings/ip/network/hosts/node}?>
													<ipv4>
														<address>
															<ip>{/GCSE/service-information/service-options/ip-settings/ip/network/hosts/address}</ip>
															<mask>{/GCSE/service-information/service-options/ip-settings/ip/network/hosts/subnet-mask}</mask>
														</address>
													</ipv4>
												<?end?>
											<?end?>
										</GigabitEthernet>
									</GigabitEthernet-subinterface>
								</interface>
								<router xmlns="http://tail-f.com/ned/cisco-ios-xr">
									<?foreach {/GCSE/service-information/service-options/ip-settings/routing/bgp/peering}?>
										<?if {/device = /GCSE/service-information/service-options/ip-settings/routing/bgp/peering/node}?>
											<bgp>
												<bgp-no-instance>
													<id>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/local-asn}</id>
													<vrf>
														<name>{/GCSE/service-information/network-options/vpnv4/vrf}</name>
														<address-family>
															<ipv4>
																<unicast/>
															</ipv4>
														</address-family>
														<neighbor>
															<id>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/remote-address}</id>
															<remote-as>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/remote-asn}</remote-as>
															<update-source>
																<GigabitEthernet-subinterface>
																	<GigabitEthernet>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/update-source}</GigabitEthernet>
																</GigabitEthernet-subinterface>
															</update-source>
															<address-family>
																<ipv4>
																	<unicast>
																		<route-policy>
																			<direction>in</direction>
																			<name>PASS</name>
																		</route-policy>
																		<route-policy>
																			<direction>out</direction>
																			<name>PASS</name>
																		</route-policy>
																	</unicast>
																</ipv4>
															</address-family>
														</neighbor>
													</vrf>
												</bgp-no-instance>
											</bgp>
										<?end?>
									<?end?>
								</router>
							<?end?>
						<?end?>
					<?end?>
					<?if {/GCSE/transport-information/options/settings/equipment-information/nodes/node-type = 'CPE'}?>
						<?foreach {/GCSE/transport-information/options/settings/equipment-information/nodes/CPE}?>
							<?if {/GCSE/transport-information/options/settings/equipment-information/nodes/CPE/software = 'iosxe'}?>
								<?if {/GCSE/service-information/network-options/protocol = 'vpnv4'}?>
									<vrf xmlns="urn:ios">
										<definition>
											<name>{/GCSE/service-information/network-options/vpnv4/vrf}</name>
											<rd>100:100</rd>
											<address-family>
												<ipv4>
												</ipv4>
											</address-family>
										</definition>
									</vrf>
								<?end?>
								<interface xmlns="urn:ios">
									<GigabitEthernet>
										<?foreach {/GCSE/transport-information/options/settings/equipment-information/nodes/CPE/service-transport}?>
											<name>{/GCSE/transport-information/options/settings/equipment-information/nodes/CPE/service-transport/service-interface}</name>
										<?end?>
										<?if {/GCSE/transport-information/options/settings/circuit-information/fttx/encapsulation/encapsulation-type = 'dot1q'}?>
											<encapsulation>
												<dot1Q>
													<vlan-id>{/GCSE/transport-information/options/settings/circuit-information/fttx/encapsulation/dot1q/cvlan}</vlan-id>
												</dot1Q>
											</encapsulation>
										<?end?>
										<?if {/GCSE/service-information/network-options/protocol = 'vpnv4'}?>
											<vrf>
												<forwarding>{/GCSE/service-information/network-options/vpnv4/vrf}</forwarding>
											</vrf>
										<?end?>
										<?foreach {/GCSE/service-information/service-options/ip-settings/ip/network/hosts}?>
											<?if {/device = /GCSE/service-information/service-options/ip-settings/ip/network/hosts/node}?>
												<ip>
													<address>
														<primary>
															<address>{/GCSE/service-information/service-options/ip-settings/ip/network/hosts/address}</address>
															<mask>{/GCSE/service-information/service-options/ip-settings/ip/network/hosts/subnet-mask}</mask>
														</primary>
													</address>
												</ip>
											<?end?>
										<?end?>	
									</GigabitEthernet>
								</interface>
								<router xmlns="urn:ios">
									<?foreach {/GCSE/service-information/service-options/ip-settings/routing/bgp/peering}?>
										<?if {/device = /GCSE/service-information/service-options/ip-settings/routing/bgp/peering/node}?>
											<bgp>
												<as-no>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/local-asn}</as-no>
												<address-family>
													<with-vrf>
														<ipv4>
															<af>unicast</af>
															<vrf>
																<name>{/GCSE/service-information/network-options/vpnv4/vrf}</name>
																<redistribute>
																	<connected/>
																</redistribute>
																<neighbor>
																	<id>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/remote-address}</id>
																	<remote-as>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/remote-asn}</remote-as>
																	<activate/>
																	<update-source>
																		<GigabitEthernet>{/GCSE/service-information/service-options/ip-settings/routing/bgp/peering/update-source}</GigabitEthernet>
																	</update-source>
																</neighbor>
															</vrf>
														</ipv4>
													</with-vrf>
												</address-family>
											</bgp>
										<?end?>
									<?end?>
								</router>
							<?end?>
						<?end?>
					<?end?>
				<?end?>
			</config>
		</device>
	</devices>
</config-template>
